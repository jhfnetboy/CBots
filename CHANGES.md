# CBots 变更日志

## 版本 0.23.48 (2024-04-01)
- 修复图片发送时的 "The extension of the photo is invalid" 错误
- 强制使用 force_document=True 参数发送图片，绕过 Telethon 对照片格式的验证
- 添加对图片文件扩展名的自动检查和修正，确保扩展名有效
- 改进错误处理和日志记录

## 版本 0.23.47 (2024-04-01)
- 优化防重复发送机制，将时间窗口从30秒减少到5秒
- 简化消息哈希生成逻辑，移除日期字符串，避免错误判定为重复消息
- 提高用户体验，减少重复点击的等待时间

## 版本 0.23.46 (2024-04-01)
- 修复私聊 /PNTs 命令未能正确处理的问题，优化私聊消息处理逻辑
- 修改 /pass 命令，允许在公开群组直接回复当日密码
- 优化图片发送格式，改为正常图文消息格式，不再以文档形式发送
- 为消息发送和推文发送接口添加防重复点击机制，30秒内相同内容不允许重复发送

## 版本 0.23.45 (2024-04-01)
- 取消对 Twitter 服务启动的注释，恢复 Twitter 功能
- 重构命令处理逻辑，为每个命令创建独立的处理函数
- 更新命令帮助信息，明确指出哪些命令可在公共群组使用，哪些需要私聊
- 添加 /price、/event、/task 命令在公共群组显示相关信息
- 改进 /pnts 和 /account 命令，在私聊中显示详细信息，在公共群组提示私聊
- 保持现有的每日密码、自动禁言新用户和私聊解禁用户的功能不变

## 版本 0.23.44 (2024-04-01)
- 修复图片发送扩展名问题，使用 force_document=True 参数强制作为文档发送图片
- 更新 web_service.py 中的端口配置，根据 MODE 环境变量选择不同的端口
- 开发环境 (MODE=dev) 使用 DEV_PORT (默认 8873)
- 生产环境使用 PRD_PORT (默认 8872)

## 版本 0.23.43 (2024-04-01)
- 修改 web_service.py 中的端口配置，从环境变量加载 PORT，默认为 8873
- 优化项目结构，明确 image_sender.py 的职责和接口

## 版本 0.23.42 (2024-04-01)
- 修复 Telegram 发送图片时的扩展名问题
- 创建独立的图片发送功能模块 (image_sender.py)
- 确保图片 BytesIO 对象带有正确的文件名和扩展名属性
- 优化图片处理逻辑，支持从 Base64 和 URL 正确提取扩展名
- 统一图片处理方式，使用固定的扩展名格式 (jpeg) 确保兼容性
- 改进错误处理和日志记录 